<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.7.19 (475949)"/><meta name="author" content="林源"/><meta name="created" content="2019-04-06 03:23:00 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-04-25 18:47:24 +0000"/><title>2019.04.05_KLT</title></head><body><ul><li><div><span style="font-size: 18px;">KLT算法</span></div></li></ul><div style="padding: 0px 20px 15px 77px; box-shadow: rgb(221, 221, 221) 0px 2px 0px; background-color: rgb(255, 255, 255); font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;"><div style="padding: 0px; word-break: break-word; text-align: justify; overflow: hidden;"><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　近来在研究跟踪，跟踪的方法其实有很多，如粒子滤波（pf）、meanshift跟踪，以及KLT跟踪或叫Lucas光流法，这些方法各自有各自的有点，对于粒子滤波而言，它能够比较好的在全局搜索到最优解，但其求解速度相对较慢，由于其是基于颜色直方图的计算，所以对相同颜色东西不太能够区别，meanshift方法很容易陷入局部最优，但速度还是挺快，所以现在很有一些人是将meanshift跟pf结合做跟踪，恰好在很多方面能够互补。
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　Kanade-Lucas-Tomasi方法，在跟踪方面表现的也不错，尤其在实时计算速度上，用它来得到的，是很多点的轨迹“trajectory”，并且还有一些发生了漂移的点，所以，得到跟踪点之后要进行一些后期的处理，说到Kanade-Lucas-Tomasi方法，首先要追溯到Kanade-Lucas两人在上世纪80年代发表的paper：An Iterative Image Registration Technique with an Application to Stereo Vision，这里讲的是一种图像点定位的方法，即图像的局部匹配，将图像匹配问题，从传统的滑动窗口搜索方法变为一个求解偏移量d的过程，后来Jianbo Shi和Carlo Tomasi两人发表了一篇CVPR(94')的文章Good Features To Track，这篇文章，主要就是讲，在求解d的过程中，哪些情况下可以保证一定能够得到d的解，这些情况的点有什么特点（后来会发现，很多时候都是寻找的角点）。
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　PS: 其实我很奇怪这个算法为什么叫做KLT算法，而不加上Jianbo Shi的名字~
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　好吧，前戏就这么多，接下来进入正题，KLT是如何实现跟踪的？
</span></div><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">　　先说KLT算法的几个前提假设：</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">　  1）亮度恒定</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">　  2）时间连续或者是运动是“小运动”</span></div><div><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">     3）空间一致，临近点有相似运动，保持相邻
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　这几个为什么要这么假设，我在后面来解释，很直观的讲，如果判断一个视频的相邻两帧I、J在某局部窗口w上是一样的，则在窗口w内有：I(x, y, t) = J(x', y', t+τ)，亮度恒定的假设(假设1)即为了保证其等号成立不受亮度的影响，假设2是为了保证KLT能够找到点，假设3则为以下原因假设（即对于同一个窗口中，所有点的偏移量都相等）：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　在窗口w上，所有(x, y)都往一个方向移动了(dx,  dy)，从而得到(x', y')，即t时刻的(x, y)点在t+τ时刻为(x+dx, y+dy)，所以寻求匹配的问题可化为对以下的式子寻求最小值，或叫做最小化以下式子：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/3AC714F1-F8B0-4022-836B-492DB18E6886.jpg" height="87" width="633"/><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">用积分来表示上述式子，以上式子可等效为：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/2D4C9F9D-C80B-4B22-9B9E-28BBCC4277E3.jpg" height="63" width="414"/><br/></div><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">　　这个式子的含义，即找到两副图像中，在W窗口中，I、J的差异，其中I以</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6;">x-d/2</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">为中心，J以</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.6;">x+d/2</span><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">为中心，w/2为半径的一个矩形窗口间的差异，好吧，结合我们微积分的知识，函数ε(d)要取得最小值，这个极值点的导数一定为0，即</span></div><div><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/C58E1816-9042-4871-8551-94570B27461D.jpg" height="61" width="700"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">的值为0，由泰勒展开的性质：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/07377638-8ADD-4461-9513-D412C06232C8.jpg" height="59" width="463"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">可以得到：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/C616F05D-AF3D-433D-A6E1-615135788D79.jpg" height="65" width="403"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/8E069A3C-C16B-4810-A274-D5A3B892029A.jpg" height="60" width="394"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">于是，问题转化为：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/E4A55FBF-40FE-4A93-BA46-77AF3A359A83.jpg" height="119" width="697"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">其中：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/C6F7D318-751C-4411-BC98-8E8AA739A489.jpg" height="49" width="286"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">从而，问题即为：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/79125646-82EA-44CD-9EEE-1FAE8A667DE9.jpg" height="64" width="501"/><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">=&gt;
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/2FC8D352-DA92-4491-81E9-EC37DC1E74E2.jpg" height="120" width="646"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">即其等式可看作为：
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/78197129-4666-49E6-85A1-BFF3C5548497.jpg" height="27" width="74"/><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">其中，Z为一个2*2的矩阵，e为一个2*1的向量，
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/68A713F5-690F-449B-804A-1D43EAE2C0AF.jpg" height="65" width="296"/><br/></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><img src="2019.04.05_KLT.resources/03F04052-F815-421A-95F3-740AF14B8821.jpg" height="55" width="349"/><br/></div><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">为了要使d能够得到解，则Z需要满足条件，即Z*Z'矩阵可逆，其中Z'为Z矩阵的转置(ZT)，在一般情况下，角点具有这样的特点。</span></div><div><br/></div><div><br style=" padding: 0px;"/></div><div><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">在OpenCV里面，找角点的函数可用
</span></div><div style="padding: 0px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; font-size: 12px !important;"><div style="padding: 0px; white-space: pre-wrap; overflow-wrap: break-word; background-color: rgb(238, 238, 238); border: 0px; overflow: auto; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; font-size: 12px !important; background-position: initial initial; background-repeat: initial initial;"><div><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> cvGoodFeaturesToTrack(</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">const</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> CvArr*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> image</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   CvArr</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">* eigImage, CvArr*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> tempImage</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   CvPoint2D32f</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> corners</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">int</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> cornerCount</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">double</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> qualityLevel</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">double</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> minDistance</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">const</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> CvArr* mask=</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">NULL</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">int</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> blockSize=</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">3</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">int</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> useHarris=</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">0 //一般采用Harris角点</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">   </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">double</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> k=</span><span style="font-size: 12px; color: rgb(128, 0, 128); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">0.04</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> );</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">然后可以通过函数cvCalcOpticalFlowPyrLK进行跟踪（好像OpenCV里面调用LK的函数不止这一个，这个是金字塔计算）：
</span></div><div style="padding: 0px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; font-size: 12px !important;"><div style="padding: 0px; white-space: pre-wrap; overflow-wrap: break-word; background-color: rgb(238, 238, 238); border: 0px; overflow: auto; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; font-size: 12px !important; background-position: initial initial; background-repeat: initial initial;"><div><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> cvCalcOpticalFlowPyrLK(</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">const</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> CvArr*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> prev,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">const</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> CvArr*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> curr,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    CvArr</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> prevPyr,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    CvArr</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> currPyr,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">const</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> CvPoint2D32f*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> prevFeatures,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    CvPoint2D32f</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> currFeatures,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">int</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> count,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    CvSize winSize,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">int</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> level,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">char</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> status,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">float</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;">*</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;"> track error,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    CvTermCriteria criteria,</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">    </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.5;">int</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;"> flags );</span></div></div></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;">　　OK，KLT算法的原理基本就这样，其实其跟踪效果并非太准，后来有很多提出的校正的方法，其中我目前看到比较实用的就是TLD算法的作者Zdenek Kalal在他2010年ICPR上的文章Forward-Backward Error: Automatic Detection of Tracking Failures提出的方法。
</span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="text-indent: 0px; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Verdana, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.6;-en-paragraph:true;"><br/></span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: &quot;Lucida Grande&quot;;"><img src="2019.04.05_KLT.resources/671556217510_.pic_hd.jpg" height="1236" width="1692"/></span><span style="font-family: &quot;Lucida Grande&quot;;"><a href="2019.04.05_KLT.resources/15.1_Tracking__KLT.pdf">15.1_Tracking__KLT.pdf</a></span></div><div style="padding: 0px; text-indent: 0px; margin-top: 1em; margin-bottom: 1em;"><span style="font-family: &quot;Lucida Grande&quot;;"><a href="2019.04.05_KLT.resources/Kanade-Lucas-Tomasi%20Tracker.pdf">Kanade-Lucas-Tomasi Tracker.pdf</a></span><br/></div></div></div><div><br/></div></body></html>